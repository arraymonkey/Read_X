var x,spanx,doc,whereDidweResume,spanidOfAlldescendants,alldescendantsToSpanid,Mydialog,px,py,startTimer,startedReadingIndex,_curentTarget,_allDescendantsCounter,myHilightSpan,childsNodeValue,docsFirstChild,lastDoc,oldBoundIndex,MylinkedList,lastCurrent,_currentURL,wordsToNodes,nodesToWords,domain,attributeName,attributeValue,removeNickNames,rerender,renderStart,renderEnd,lastPos,zerothDescendant,elements,words,lastEndRect,xloc,yloc,speechCircle,debugging=!1,spanxLocations=[],beforelastoffset=0,lastoffset=0,offset=2,speechRate=2,canceled=!0,SpeechSynthesisMessage=new SpeechSynthesisUtterance,voices=speechSynthesis.getVoices(),spaceBuffer=0,richCaretIndex=0,spanid=0,originalHtml="",originalOffset=0,substringLocation=0,lastHilight=-1,currentVoice=2,voiceName="Microsoft Aria Online",NotOnboundary=!1,isEdge=!1,_maximumChars=250,canClick=!1,loaded=!1,hasspeechCircle=!1,circlebottom="10px",circleright="10px",circleleft=null,circletop=null,dragsizeValue=30,ranAtLeastOnce=!1,readMultipleNodes=!1,mappingMultipleNodes=!1,spaceAlternative="\x02",NullSpaceAlternative="",autoscroll=!0,rescan=!1,originalTitle="",tooBig=!1,scrollLocation=null,_brandNew=!0,_ultrafast=!0,_ultra_Xstr="",_ultra_descendants=[],_ultra_index=0,_ultra_lastRect=null,_globalLinkedList=null,_globalLinkedListChildren=[],_mapping_xLength=!1,_ultra_xLength=0,_ultra_xLengthBuffer=0,_ultra_xLengthRead=0,_ultra_Loops=0,nullOtterance="",applyVoiceOtterance="",lastIndexOfNU=0,lastCharIndexOfNU=0,ultraFastOtterance="",rightOffset=0,lastCurrentIndex=0,yellowHighlightOnly=!0,useDoubleClick=!0,iframeDisabled=0,outputOriginalText=!1,outputWhatIsBeingRead=!1,lastParagraphs=[],lastParagraphcharIndex=0,lastParagraphShortcut=null,nextParagraphShortcut=null,playPauseShortcutKey="",defaultKey=!0,spacebarValue=!1,supressHighlight=!1,shadow_descendants=[],unified_emoji_ranges=["[\ud800-\udbff]","[\udc00-\udfff]"],replaceDictionary={"[̀-ͯ]":"","[“”]":'"'},lastReplaceDictionaryStr="",lastEraseDictionary="",eraseDictionary={},autoPlayList={},oncePerPage=!1,nextTrigger="",nextTriggerText="",autoReadContainer=null,overflowArray=[],requestType=0,urlDataArray=[],EngVoicesArr=[],pitch=1,listOfVoices="united states|new zealand|canda|united kingdom|australia|south africa",listOfLocales="english",constantlyChangingContent=!1,fromEnd=!1,innerElements=[],delayedClickPressed=!1,allowSVG=!1,readAriaHidden=!1,myHandle=null;function randonNumber(){return Math.floor(999*Math.random())+1e3}function confirmExit(){return"ReadX is still reading this page, are you sure you want to leave?"}function debugIt(e,t="N/A"){debugging&&(console.log(t),console.log(e))}/Edg/.test(navigator.userAgent)&&(_maximumChars=700,isEdge=!0);var totalReadStrLen=0,lastReadstr="",afiLastHighligt=-1;function adjustforinflation(e){try{afiLastHighligt!=lastHilight&&lastReadstr&&(totalReadStrLen+=lastReadstr.length,afiLastHighligt=lastHilight,lastReadstr="");let t=spanxLocations[lastHilight];readMultipleNodes&&(t=nodesToWords[t]);let n=trimmer(originalHtml.substring(0,e-t));return lastReadstr=n,NotOnboundary&&(lastReadstr=originalHtml),n.length+totalReadStrLen}catch(l){return 0}}function getEstimatedProgress(){try{_ultrafast?(e=_ultra_xLength,t=adjustforinflation(richCaretIndex)+_ultra_xLengthRead):(e=x.length,t=richCaretIndex),-1==startedReadingIndex&&(startedReadingIndex=t),""==originalTitle&&(originalTitle=document.title);var e,t,n=Date.now()-startTimer,l=t-startedReadingIndex,a=e-t,r=n/l*a;if(r>=0&&r!=1/0){var o=msToTime(r)+" "+(t/e*100).toFixed(2)+"% ";outputEsimatedProgress(o)}}catch(s){}}function outputEsimatedProgress(e){""!=originalTitle&&(e=e+" "+originalTitle,document.title=e)}function msToTime(e){let t=e/1e3,n=e/6e4,l=e/36e5,a=(e/864e5).toFixed(1);return t<60?t.toFixed(1)+" Sec":n<60?n.toFixed(1)+" Min":l<24?l.toFixed(1)+" Hrs":a+" Days"}function readText(e){if(null==x)return;if(canceled=!1,startedReadingIndex=-1,startTimer=Date.now(),speechSynthesis.paused&&e){speechSynthesis.resume();return}if(void 0==richCaretIndex&&(richCaretIndex=0),(lastoffset=richCaretIndex)==x.length&&(lastoffset=0,richCaretIndex=0),beforelastoffset=lastoffset,"\n"==x.charAt(beforelastoffset)&&beforelastoffset++,removeMultipleNodeHilights(),!1==getNextIndexThatIsNotEmpty())return outputWhatIsBeingRead&&console.log("No words there.."),lastParagraphs=[],canceled=!0,404;offset<0&&(offset=x.length);let t=speakMessage();sendMessageToBackground("reading"),window.onbeforeunload=confirmExit,outputEsimatedProgress(""),t&&(highlight(),startSlightFlicker()),lastoffset=offset,!delayedClickPressed&&t&&speechSynthesis.speak(SpeechSynthesisMessage),delayedClickPressed=!1}function startSlightFlicker(){try{if(yellowHighlightOnly&&allSelectedNodes&&allSelectedNodes.length>0){var e=[];for(let t=0;t<allSelectedNodes.length&&t<100;t++)allSelectedNodes[t]instanceof HTMLElement&&(e.push(allSelectedNodes[t].style.boxShadow),allSelectedNodes[t].style.boxShadow="0px 3px 8px rgba(174,203,250, 0.54)",allSelectedNodes[t].style.transition="0.3s ease-in-out");setTimeout(function(){for(let t=0;t<allSelectedNodes.length&&t<100;t++)allSelectedNodes[t]instanceof HTMLElement&&(allSelectedNodes[t].style.boxShadow=e[t],allSelectedNodes[t].style.transition="0.3s ease-in-out")},600)}}catch(n){console.log(n)}}function haswords(){var e=x.substring(lastoffset,offset);let t=RegExp(spaceAlternative,"g"),n=voices[langDetector(e=e.replace(t,""))].name;return e=isItAWord(e,n),trimmer(e).length>0}function isItAWord(e,t){var n="^@#$%^&*=";if(null!=t.match(/english/gi)){let l=RegExp("["+n+"a-z0-9]","gi");e=e.replace(l,"")}else if(null!=t.match(/русский|russian/gi)){let a=RegExp("["+n+"a-z0-9а-я]","gi");e=e.replace(a,"")}else{let r=RegExp(/[^0-9\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+/,"g");e=e.replace(r,"")}return e}function speakMessage(){pressedOnBookmarkOrPlay=!0,changeSpeechCircleColor();var e=0;"\n"==x.charAt(lastoffset+e)&&0!=beforelastoffset&&e++;var t=x.substring(lastoffset+e,offset);try{if(t=t.replace(/[\u2018\u2019]/g,"'"),readMultipleNodes){let n=RegExp(spaceAlternative,"g");t=t.replace(n," "),lastCharIndexOfNU=0,rightOffset=0,nullOtterance=t,applyVoiceOtterance=t,lastIndexOfNU=0,n=RegExp(/\n/,"gm"),t=t.replace(n," ")}}catch(l){console.log(l)}SpeechSynthesisMessage.volume=1,SpeechSynthesisMessage.rate=speechRate;let a=langDetector(t);if(a=(values=shouldApplyVoiceChange(a,t)).voiceChange,0==(t=values.msgStr).replace("..."," ").trim().length)return lastoffset=offset,lastPos=x.length,zerothDescendant=-1,myOnEnd(null,!0),!1;SpeechSynthesisMessage.pitch=1,SpeechSynthesisMessage.text=t;var r=voices[a];return SpeechSynthesisMessage.voice=voices[a],SpeechSynthesisMessage.voiceURI=r.voiceURI,SpeechSynthesisMessage.lang=r.lang,outputWhatIsBeingRead&&(console.log("READING:"),console.log(t)),!0}function mulberry32(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}function shouldApplyVoiceChange(e,t){let n="ApplyVoiceChange:x ",l=t.indexOf(n),a=t.indexOf("ApplyVoiceChange:o "),r=0;if(r=l>=0?l:a,l>=0||a>=0){pupulateEnglishVoices();let o=t.substring(r+n.length).indexOf(" ..."),s=o;-1==o&&(s=o=t.substring(r+n.length).indexOf(" "),a>=0&&(o=t.substring(r+n.length).length)),-1==o&&(o=t.length-n.length-r);var u=getHash(t.substring(r+n.length,n.length+s));1==EngVoicesArr.length?voiceName=regexEscape(voices[e=EngVoicesArr[0]].name):EngVoicesArr.length>1&&(voiceName=regexEscape(voices[e=EngVoicesArr[u%EngVoicesArr.length]].name)),t=(t=l>=0?erase(regexEscape(t.substring(r,n.length+r)),"g",t):erase(regexEscape(t.substring(r,o+n.length+r)),"g",t)).replace(/\.\.\./,"   "),pitch=u}return{msgStr:t,voiceChange:e}}function getPitchRange(e,t,n){return(e-0)/(t-0)*(n-0)+0}function pupulateEnglishVoices(){if(!(EngVoicesArr.length>0))for(let e=1;e<voices.length;e++){let t=RegExp(listOfVoices,"ig"),n=RegExp(listOfLocales,"ig");voices[e].name.match(t)&&voices[e].name.match(n)&&EngVoicesArr.push(e)}}function getHash(e){for(var t=0,n=e.length,l=0;l<n;l++)t=(t<<5)-t+e.charCodeAt(l),t++,t|=0;return Math.abs(t)}function delayedSpeak(){var e=0,t=-1,n=setInterval(function(){if(e++,!scrollable()||t==window.pageYOffset||e>10||1>=Math.abs(parseInt(window.pageYOffset)-parseInt(scrollLocation)))clearInterval(n),!1==canceled&&setTimeout(function(){isEdge||speechSynthesis.speak(SpeechSynthesisMessage),isEdge&&speechSynthesis.speak(SpeechSynthesisMessage),scrollLocation=null},50);else{t=window.pageYOffset;return}},100)}function scrollable(){return!document.hidden&&null!=scrollLocation&&!(scrollLocation<0)&&!(window.innerHeight+window.scrollY>=document.body.scrollHeight)}function delayedScroll(e){scrollLocation=e,scrollable&&!(1>=Math.abs(parseInt(window.pageYOffset)-parseInt(scrollLocation)))&&window.scrollTo({top:e,behavior:"smooth"})}function langDetector(e){currentVoice=selectVoice(voiceName,0);var t=detectLanguage(e);return(null==t||t<0)&&(t=0),t}var autoDetected=-1;function detectLanguage(e){if(null!=voiceName.match(/russian/gi)&&(autoDetected=-1),null!=e.match(/[а-я]+/gi)&&null==e.match(/[a-z]+/gi)&&null==voiceName.match(/russian/gi)){var t=selectVoice(/русский|russian/gi,currentVoice);return autoDetected=t,t}return autoDetected>=0&&null==e.match(/[a-z]+/gi)?autoDetected:(autoDetected=-1,currentVoice)}function selectVoice(e,t){var n;for(n=0;n<voices.length;n++)if(voices[n].name.match(e))return n;return t}function unHilight(){try{null!=lastDoc&&(lastDoc.removeAttribute("style"),setInheritColor(lastDoc))}catch(e){console.log(e)}whereDidweResume=-1}function clickorendHighlightReset(){try{null!=doc&&removeMyHighlight(),nodesToWords&&removeMultipleNodeHilights(),null!=lastDoc&&(lastDoc.removeAttribute("style"),setInheritColor(lastDoc)),lastHilight=-1,originalHtml="",originalOffset=0,doc=null}catch(e){console.log(e)}}function removeMultipleNodeHilights(){try{for(var e=0;e<allSelectedNodes.length;e++){var t=allSelectedNodes[e];if(t&&t instanceof HTMLElement){if(t.removeAttribute("style"),setInheritColor(t),t?.firstChild!=null)try{null!=myHilightSpan&&(highlightRemoved=!0,myHilightSpan.remove(),myHilightSpan=null,docsFirstChild.nodeValue=childsNodeValue,removeOverflowElments()),t?.parentNode!=null&&t.parentNode.insertBefore(t.firstChild,t)}catch(n){console.log(n)}t&&(t.remove(),t=null)}}}catch(l){console.log(l)}lastHilight=-1,allSelectedNodes=[]}function isDelimiterOrSpace(e){return"."==e||"!"==e||"?"==e||" "==e}function findNewLine(){let e=0;var t=0;if(NotOnboundary)return lastoffset;"\n"==x.charAt(lastoffset)&&lastoffset++;for(let n=0;n<spanxLocations.length&&!((e=nodesToWords[spanxLocations[n]])-1>=lastoffset)&&0!=lastoffset;n++)e&&("\n"==x.charAt(e-1)||"\n"==x.charAt(e))&&(t="\n"==x.charAt(e-1)?e:e+1);return t}function setLastHighlightPosition(e){lastPos=e,zerothDescendant=alldescendants[0]}function needsHighlighting(){return offset>lastPos+1||zerothDescendant!==alldescendants[0]}var allSelectedNodes=[],bussyHilighting=!1;function highlight(e=autoscroll){var t=!1,n=0;if(scrollLocation=null,readMultipleNodes&&nodesToWords){bussyHilighting=!0,removeMultipleNodeHilights();let l=findNewLine();for(n=0;n<spanxLocations.length-1;n++)if(spanxLocations[n+1]<=wordsToNodes[l]);else{mappingMultipleNodes=!0;var a=spanidOfAlldescendants[n];a>=0&&alldescendants[a]&&(trimmer(alldescendants[a].nodeValue).length>0&&alldescendants[a].nodeValue.trim().length>0||1==alldescendants[a].nodeValue.length&&" "==alldescendants[a].nodeValue)&&(pushNodeSelection(n,a),1==allSelectedNodes.length&&(0==lastParagraphs.length||lastParagraphs.length>0&&lastParagraphs[lastParagraphs.length-1]!=alldescendants[a])&&(lastParagraphs.push(alldescendants[a]),lastParagraphcharIndex=spanxLocations[n],lastParagraphs.length>200&&lastParagraphs.shift())),mappingMultipleNodes=!1;var r=offset;if(null==wordsToNodes[offset]&&r--,setLastHighlightPosition(nodesToWords[spanxLocations[n+1]]),nodesToWords[spanxLocations[n+1]]==x.length-1){setLastHighlightPosition(nodesToWords[spanxLocations[n+1]]+2);break}if(nodesToWords[spanxLocations[n+1]]>=r){if(NotOnboundary)break;let o=nodesToWords[spanxLocations[n+1]];if(n+1==spanxLocations.length||o&&("\n"==x.charAt(o-1)||"\n"==x.charAt(o)))break}}var s=x.substring(beforelastoffset,offset),r=0;("\n"==s.charAt(0)||" "==s.charAt(0))&&r++;var u=whatIsTheCurrentNode(r)+1;if(allSelectedNodes&&allSelectedNodes[0]&&allSelectedNodes[0]instanceof HTMLElement){let d=allSelectedNodes[0].getBoundingClientRect(),c=calculateTotalHeight(allSelectedNodes),g=d.top+window.pageYOffset-window.innerHeight/2+c/2;if(tooBig=c>window.innerHeight,NotOnboundary||null!=voiceName.match(/google/gi)){for(;u>0&&u<allSelectedNodes.length;u++)styleNodes(allSelectedNodes[u]);null!=lastDoc&&yellowHighlight("#AECBFA",0,s.trimEnd().length,lastDoc)}0==c||inIframe()?highlightSelectedNodes():null!=lastDoc&&hasWhiteSpaceStyle(lastDoc.firstChild)&&lastDoc.firstChild.nodeValue.match(/\n/g)?yellowHighlight("#AECBFA",0,s.trimEnd().length,lastDoc):(highlightSelectedNodes(),e&&!tooBig&&delayedScroll(g))}bussyHilighting=!1}else for(n=0;n<spanxLocations.length;n++)if(spanxLocations[n]>=lastoffset){n>0&&spanxLocations[n]+1>offset&&n--,n+1<spanxLocations.length&&offset>spanxLocations[n+1]+1&&n++,t=!0;break}if(t){null!=lastDoc&&(lastDoc.removeAttribute("style"),setInheritColor(lastDoc),doc=lastDoc,removeMyHighlight());var a=spanidOfAlldescendants[n];if(a>=0&&alldescendants[a]&&trimmer(alldescendants[a].nodeValue).length>0&&(lastDoc=createSpan(n),wrap(alldescendants[a],lastDoc)),null!=lastDoc&&(!NotOnboundary&&lastDoc&&lastDoc.style&&styleNodes(lastDoc),e&&lastDoc.scrollIntoView({behavior:"smooth",block:"center"})),lastHilight=n,(NotOnboundary||null!=voiceName.match(/google/gi))&&null!=lastDoc){var s=x.substring(beforelastoffset,offset);yellowHighlight("#AECBFA",0,s.trimEnd().length,lastDoc)}}if(oncePerPage&&null!=autoReadContainer&&nextTrigger.trim().length>0&&!isDescendant(autoReadContainer[0],lastDoc)){pause(),delayedClickPressed=!0;let $=document.querySelectorAll(nextTrigger);oncePerPage=!1;for(let f=0;f<$.length;f++)if(($[f].innerText.trim().length>0||0==nextTriggerText.trim().length)&&nextTriggerText.trim().indexOf($[f].innerText.trim())>=0){delayedClick($[f]);break}}}function traverseTagName(e,t){for(;null!=e&&void 0!=e;){if(e.tagName&&e.tagName.match(t))return!0;e=e?.parentNode}return!1}function pushNodeSelection(e,t){traverseTagName(alldescendants[t].parentNode,/\bsvg\b/gi)?allSelectedNodes.push(alldescendants[t]):(lastDoc=createSpan(e),wrap(alldescendants[t],lastDoc),allSelectedNodes.push(lastDoc))}function delayedClick(e){setTimeout(function(){nodesToWords&&removeMultipleNodeHilights()},500),setTimeout(function(){e.click()},1e3)}const isDescendant=function(e,t){let n=t.parentNode;if(!n)return console.log("null node 1 "),!0;for(;n;){if(n===e)return!0;n=n.parentNode}return!1};function highlightSelectedNodes(){for(let e=0;e<alldescendants.length;e++)!NotOnboundary&&allSelectedNodes[e]&&allSelectedNodes[e].style&&styleNodes(allSelectedNodes[e])}function styleNodes(e){yellowHighlightOnly||(e.style.backgroundColor="#AECBFA",e.style.color="black")}function styleNodesString(){return yellowHighlightOnly?"<customreadxspanbefore>":"<customreadxspanbefore style='background-color:#AECBFA !important; color:black !important;'>"}function styleNodesString2(){return yellowHighlightOnly?"":"background-color:#AECBFA !important; color:black !important;"}function styleNodesStringAfter(e,t){return yellowHighlightOnly?"' style='background-color:"+(e=getOtteranceColor(e,t))+" !important'":"' style='background-color:"+e+" !important; color:black !important;'"}function styleNodesStringAfter2(e,t){return yellowHighlightOnly?"background-color:"+(e=getOtteranceColor(e,t))+" !important":"background-color:"+e+" !important; color:black !important;"}function getOtteranceColor(e,t){if(yellowHighlightOnly){var n=window.getComputedStyle(t).getPropertyValue("color");e=isColorBright(n=splitRGB(n))?"green":"yellow"}return e}function splitRGB(e){return e=e.substring(4,e.length-1).replace(/ /g,"").split(",")}function isColorBright(e){var t=e[0],n=e[1],l=e[2];return Math.sqrt(.299*(t*t)+.587*(n*n)+.114*(l*l))>200}function calculateTotalHeight(e){try{let t=allSelectedNodes[0].getBoundingClientRect();for(var n=1;n<e.length&&null==allSelectedNodes[e.length-n];n++);let l=allSelectedNodes[e.length-n].getBoundingClientRect();if(t.top==l.top)return Math.max(t.height,l.height);return l.top-t.top+l.height}catch(a){}}function getNextIndexThatIsNotEmpty(){var e=0;let t=!1;do if(offset=getIndex(x,lastoffset+1),e++,!1==(t=haswords())&&(beforelastoffset=lastoffset=offset,"\n"==x.charAt(beforelastoffset)&&beforelastoffset++),lastoffset==offset&&offset>x.length)return!1;while(!1==t&&!1==(t=haswords())&&e<200);return t}function sleep(e){return new Promise(t=>setTimeout(t,e))}async function myOnEnd(e,t=!1){if(await sleep(1),!0!=canceled){var n=!0;if(_ultrafast&&lastoffset>=x.length){lastoffset=0,beforelastoffset=0,richCaretIndex=0;let l=areThereMoreElements();if(n=l.hasMore,!1==t&&constantlyChangingContent&&l.hasMore&&l.values){alldescendants=[],nodesToWords=[],wordsToNodes=[],fromEnd=!0;let a=l.values[0];_curentTarget=a,Array.isArray(a)&&(_curentTarget=a[0].parent)}mapIndexForHighlight()}if(lastoffset<x.length&&!_ultrafast||_ultrafast&&n){if(beforelastoffset=lastoffset,"\n"==x.charAt(beforelastoffset)&&beforelastoffset++,!1==getNextIndexThatIsNotEmpty()){if(_ultrafast){if(lastoffset=0,beforelastoffset=0,richCaretIndex=0,mapIndexForHighlight(),!1==getNextIndexThatIsNotEmpty()){outputWhatIsBeingRead&&console.log("No _ultrafast words there."),lastParagraphs=[],clickorendHighlightReset(),togglePlayButton(),saveBookmarkToStorage(window.location.href,"");return}}else{canceled=!0,sendMessageToBackground("paused"),outputWhatIsBeingRead&&console.log("No words there."),lastParagraphs=[];return}}offset<0&&(offset=x.length);let r=speakMessage();sendMessageToBackground("reading"),needsHighlighting()||null!=voiceName.match(/google/gi)?r&&highlight():oldBoundIndex=-5,getEstimatedProgress(),richCaretIndex=lastoffset,lastoffset=offset,!delayedClickPressed&&r&&speechSynthesis.speak(SpeechSynthesisMessage),delayedClickPressed=!1}else canceled=!0,outputEsimatedProgress("0.0 Sec 100% "),clickorendHighlightReset(),sendMessageToBackground("paused"),saveBookmarkToStorage(window.location.href,"")}}SpeechSynthesisMessage.onend=function(e){setTimeout(()=>{myOnEnd(e)},10)};var highlightRemoved=!0;function removeMyHighlight(){highlightRemoved=!0;try{null!=myHilightSpan?(myHilightSpan.remove(),myHilightSpan=null,docsFirstChild.nodeValue=childsNodeValue,removeOverflowElments(),null!=doc&&null!=doc.parentNode&&(doc.parentNode.insertBefore(docsFirstChild,doc),doc.remove())):null!=doc&&doc instanceof HTMLElement&&null!=doc.parentNode&&(null!=doc.firstChild&&doc.parentNode.insertBefore(doc.firstChild,doc),doc.remove(),doc=null)}catch(e){console.log(e)}}function myOnBoundary(e){var t=e.charIndex,n=e.charLength;readMultipleNodes?!1==bussyHilighting&&(removeOverflowElments(),whatIsTheCurrentNode(t),yellowHighlight("yellow",t,n,lastDoc)):yellowHighlight("yellow",t,n,lastDoc),getEstimatedProgress()}SpeechSynthesisMessage.onerror=e=>{console.log(`Error: ${e.error}`),!1==canceled&&togglePlayButton()},SpeechSynthesisMessage.onboundary=function(e){"word"==e.name&&myOnBoundary(e)};var benchmarkTimer=null,benchmarkIndex=0,benchName="";function benchmark(e=!1,t=""){e&&(benchName=t+" ",benchmarkTimer=null,benchmarkIndex=0),null==benchmarkTimer&&(benchmarkTimer=Date.now()),console.log(benchName+benchmarkIndex+": "+(Date.now()-benchmarkTimer)),benchmarkIndex++}var overflowElements=[];function removeOverflowElments(){for(let e=0;overflowElements&&e<overflowElements.length;e++){var t=overflowElements[e];t.myHilightSpan.remove(),t.myHilightSpan=null,t.docsFirstChild.nodeValue=t.childsNodeValue}overflowElements=[]}function getLocationByIndex(e){for(var t=0,n=!1;t<spanxLocations.length-1;t++)if(null==nodesToWords[spanxLocations[t+1]]&&t+2==spanxLocations.length||nodesToWords[spanxLocations[t+1]]>beforelastoffset+e){n=!0;break}return{i:t,set:n}}function whatIsTheCurrentNode(e,t=!1,n=null){var l,a,r=0,o=0;for(r=(a=null==n?getLocationByIndex(e):n).i,l=a.set;-1==nodesToWords[spanxLocations[r]]&&r>0;)r-=1;if(-1!=lastHilight&&lastHilight!=r&&lastDoc&&null!=lastDoc.firstChild)try{null!=myHilightSpan&&(highlightRemoved=!0,t?overflowElements.push({myHilightSpan:myHilightSpan,docsFirstChild:docsFirstChild,childsNodeValue:childsNodeValue}):(removeOverflowElments(),myHilightSpan.remove(),myHilightSpan=null,docsFirstChild.nodeValue=childsNodeValue))}catch(s){console.log(s)}if(l){for(var u=spanidOfAlldescendants[r];o<allSelectedNodes.length&&lastHilight!=r;o++){let d=allSelectedNodes[o].firstChild;if(allSelectedNodes[o]instanceof HTMLElement||(d=allSelectedNodes[o]),allSelectedNodes[o]&&d===alldescendants[u]){lastDoc=allSelectedNodes[o];break}}return allSelectedNodes[o]||(o=0),lastHilight=r,o}return -1}function printString(e,t,n){for(var l="",a=t;a<n+t&&a<e.length;a++)l+=e.charAt(a);return l}function initHighlightSpan(e,t,n){if(lastHilight>=0&&null!=e&&!0==highlightRemoved){if(highlightRemoved=!1,null!=(doc=e)&&(null!=doc.firstChild||!1!=allowSVG)){if(childsNodeValue=doc?.firstChild?.nodeValue,docsFirstChild=doc?.firstChild,rerender=!0,renderStart=0,renderEnd=-1,null!=doc.firstChild){myHilightSpan=partialNode(doc.firstChild,"","myHighlight"+lastHilight,doc.firstChild),innerElements=[];for(let l=0;l<5;l++){let a=document.createElement("customreadxhspan");innerElements.push(a),myHilightSpan.appendChild(a)}if(null!=myHilightSpan&&inIframe()&&speechCircle&&speechCircle.style){speechCircle.style.transition="all .5s ease-in-out";let r=myHilightSpan.getBoundingClientRect();circletop=r.top+"px",speechCircle.style.top=circletop}}else myHilightSpan=document.createElement("div"),childsNodeValue=doc?.nodeValue;originalHtml=childsNodeValue,null!=MylinkedList&&(MylinkedList=null);var o=x.substring(beforelastoffset,offset),s=0;("\n"==o.charAt(0)||" "==o.charAt(0))&&s++;constructLinkList({i:lastHilight}),lastCurrent=null,lastCurrentIndex=0,whereDidweResume=-1,substringLocation=0,oldBoundIndex=-5}}}function constructLinkList(e){MylinkedList=new LinkedList;for(var t=_globalLinkedListChildren[e.i],n=t?.extra?.nodeIndex;null!=t&&t?.extra&&t?.extra?.nodeIndex==n;)MylinkedList.insertToTail(t.data,t.realIndex,t.extra,null,t.lastIndex),t=t.next}function computeCharIndexAndLength(e,t,n){oldBoundIndex=e,whereDidweResume<0&&((whereDidweResume=beforelastoffset-spanxLocations[lastHilight])<0&&(whereDidweResume=0),substringLocation=whereDidweResume),l=readMultipleNodes&&nodesToWords?e+beforelastoffset-nodesToWords[spanxLocations[lastHilight]]:e+substringLocation,n&&(richCaretIndex=spanxLocations[lastHilight]+l,readMultipleNodes&&nodesToWords&&(-1==nodesToWords[spanxLocations[lastHilight]]&&(lastHilight-=1),richCaretIndex=nodesToWords[spanxLocations[lastHilight]]+l+spaceBuffer));try{var l,a=MylinkedList;null==lastCurrent||NotOnboundary?lastCurrentIndex=0:a=lastCurrent;for(var r=lastCurrentIndex;null!=a.next&&r<l;r++)a=a.next,lastCurrentIndex=r+1,lastCurrent=a;a.data==spaceAlternative&&(a=a.next),l=a.next.realIndex;let o=-1,s=0;for(var r=0;r<t&&r<MylinkedList.size;r++){if(null==a.next){o=t-r;break}(a=a.next).data==NullSpaceAlternative&&(r-=1),s++}if(-1==o&&t>MylinkedList.size&&(o=t-MylinkedList.size),a.lastIndex){let u=a.lastIndex-l+1;u>0&&(t=u)}else t=a.realIndex-l+1;null==a.next&&o>0&&(t=originalHtml.length);let d=isItAWord(a.data,SpeechSynthesisMessage.voice.name);return t>1&&0==d.length&&a.data,{ev_CharLength:t,tmpCharIndex:l,tmpOverflow:o,realCharLength:s}}catch(c){}}function yellowHighlight(e,t,n,l,a=0){if(initHighlightSpan(l,t,a),null==myHilightSpan){highlightRemoved=!0;return}if(n>0&&(t!=oldBoundIndex||0==oldBoundIndex)){let r=null,o=t,s=n,u=computeCharIndexAndLength(t,n,0==a);u?(o=u.tmpCharIndex,n=u.ev_CharLength,r=u.tmpOverflow,s=u.realCharLength):o=0;var d="";try{let c=0,g=originalHtml.length,$=!1;if(hasWhiteSpaceStyle(docsFirstChild)&&childsNodeValue.match(/\n/g)){$=!0,l.removeAttribute("style"),setInheritColor(l),d=styleNodesString2(),c=originalHtml.substring(0,o).lastIndexOf("\n")+1;let f=originalHtml.substring(o+n).indexOf("\n");g=f<0?g:f+o+n}else if(inIframe()||tooBig){if(!1==rerender&&renderStart<o&&renderEnd>o+n&&renderEnd!=originalHtml.length)c=renderStart,g=renderEnd;else if($=!0,NotOnboundary||0!=a)a>0&&measureChild(docsFirstChild,myHilightSpan,0);else{d=styleNodesString2();let p=originalHtml.substring(0,o).split(" ").length,m=measureChild(docsFirstChild,myHilightSpan,p-1);(c=m[0])>o&&(c=o);let _=m[1];(g=_<0?g:_)<o+n&&(g=originalHtml.length)}}let C=computeOverflow(t,s,r,a);a>0&&(r=C.tmpOverflow,-1==r)&&(C.oneless&&n--," "==originalHtml.charAt(o+n-1)&&n--);let v="mycustomreadxhspan 101";if(0!=a&&(v="mycustomreadxhspanof "+a),null!=docsFirstChild?(docsFirstChild.nodeValue="",innerElements[1].textContent=originalHtml.substring(c,o),innerElements[2].textContent=originalHtml.substring(o,o+n),innerElements[3].textContent=originalHtml.substring(o+n,g),rerenderStartAndEnd(c,g),innerElements[2].setAttribute("id",v),innerElements[2].setAttribute("style",styleNodesStringAfter2(e,l)),""!=d&&(innerElements[1].setAttribute("style",d),innerElements[3].setAttribute("style",d))):autoscroll&&l?.parentNode.scrollIntoView({behavior:"smooth",block:"center"}),$&&0==a&&(c<=o&&c+5>=o||null!=voiceName.match(/google/gi)&&(inIframe()||tooBig)))try{var A,b=myHilightSpan.parentNode.childNodes;loop1:for(let N=0;b&&N<b.length;N++){var E=b[N].childNodes;for(let S=0;E&&S<E.length;S++)if(E[S].id==v){A=E[S];break loop1}}A&&autoscroll&&A.scrollIntoView({behavior:"smooth",block:"center"})}catch(k){console.log(k)}a>0&&null==r&&(r=n,s=0);let D=0;for(;0==D&&overflowArray.length>0&&readMultipleNodes;)D=whatIsTheCurrentNode(null,!0,{i:overflowArray.shift(),set:!0});readMultipleNodes&&r>0&&0!=D?yellowHighlight(e,t+s,r,lastDoc,a+1):spaceBuffer=0}catch(L){console.log(L)}}}function rerenderStartAndEnd(e,t){(!0==rerender||renderStart!=e||renderEnd!=t)&&(renderStart!=e&&(innerElements[0].textContent=originalHtml.substring(0,e)),renderEnd!=t&&(innerElements[4].textContent=originalHtml.substring(t)),rerender=!1),renderStart=e,renderEnd=t}function computeDifference(e){return nodesToWords[e]-e}var allRects=[];function measureChild(e,t,n){try{if(""!=e.nodeValue){allRects=[],words=(words=e.nodeValue).split(" ");let l=0,a=0;for(let r=0;r<words.length;r++){a+=words[r].length;let o=document.createRange();o.setStart(e,l),o.setEnd(e,a),a++;let s=o.getClientRects();s.length>0&&allRects.push(s[0]),l=a}}let u=allRects[n],d=n-1;for(;d>=0;d--){let c=allRects[d];if(u.top!=c.top)break}let g=n+1;for(;g<allRects.length;g++){let $=allRects[g];if(u.top!=$.top)break}let f=0,p=-1;txt="";for(let m=0;m<words.length;m++)txt+=words[m]+" ",d==m&&(f=txt.length),g-1==m&&(p=txt.length);return[f,p]}catch(_){console.log(_)}return[0,-1]}class LinkNode{constructor(e,t,n=null,l=null,a=null){this.data=e,this.extra=n,this.realIndex=t,this.lastIndex=a,this.next=l}}class LinkedList{constructor(){this.next=null,this.size=0,this.tail=null,this.resumeFrom=null,this.resumeNode=null}insertToTail(e,t,n=null,l=null,a=null){let r=new LinkNode(e,t,n,l,a);null==this.tail?(this.next=r,this.tail=r):(this.tail.next=r,this.tail=r),this.size++}giveMeTheString(){for(var e=this,t="";null!=e.next;)t+=e.next.data,e=e.next;return t}giveMeTheStringAndIndex(){for(var e=this,t="";null!=e.next;)t+="|"+e.next.realIndex+"|",t+=e.next.data,e=e.next;return t}removeAndReplaceFromIndex(e,t,n){var l=this;if(this.size<e+t)return!1;var a=0;for(this.resumeFrom&&e>this.resumeFrom&&(a=this.resumeFrom,l=this.resumeNode);null!=l.next&&a<e;a++)l=l.next;if(this.resumeFrom=a,this.resumeNode=l,null!=l.next)var r=l.next.realIndex,o=l.next.extra,s=l.next.extra;else r=-1*t,o={nodeIndex:-1},s={nodeIndex:-1};var u=0;0==t&&(u=l.next.realIndex,s=l.next.extra);for(var a=0;a<t;a++)a+1==t&&(u=l.next.realIndex,s=l.next.extra),l.next=l.next.next,this.size--;for(var d=Array.from(n),a=0;a<d.length;a++){let c=new LinkNode(d[a],r);1==d.length?c.realIndex=r:a+1==d.length&&(c.realIndex=u),a>0?(s!=o&&(c.realIndex=0),c.extra=s):c.extra=o,c.lastIndex=u,c.next=l.next,l.next=c,l=l.next,this.size++}return!0}}function processKeyValuesForReplace(e,t,n,l){var a=e,r="ig";t instanceof Object?(g=t.value,c=t.value,0==(r=t.params.replace(/[^gmisuyd]/gi,"")).length&&(r="ig")):(g=t,c=t),$=g;let o=RegExp(a,r);var s=!1;let u=!0;0>r.indexOf("g")&&(u=!1);for(var d=0;null!==(f=o.exec(l));){if(s=!0,f.index===o.lastIndex&&u&&o.lastIndex++,f.length>0&&c.match(/\$\d/gi))for(var c,g,$,f,p,m=1;m<f.length;m++){var _=RegExp("\\$"+m,"ig");g=g.replace(_,f[m])}let C="";if("\\s+"==a||"\\s{2,}"==a){var v=/\n/;f[0].match(v)?C+="\n":C+=g,p=n.removeAndReplaceFromIndex(f.index+d,f[0].length,C)}else p=n.removeAndReplaceFromIndex(f.index+d,f[0].length,g);if(!0==p&&(d+=Array.from(g).length-f[0].length),g=$,0===o.lastIndex)break}return s&&(l=n.giveMeTheString()),l}function MapForReplace(e){let t=new LinkedList;for(var n=0;n<e.length;n++)t.insertToTail(e.substring(n,n+1),n);return replaceValuesInList(t),t}function replaceValuesInList(e){var t=e.giveMeTheString();for(let[n,l]of Object.entries(replaceDictionary))try{regex=RegExp(spaceAlternative,"g"),t=t.replace(regex," "),t=processKeyValuesForReplace(n,l,e,t)}catch(a){console.log(a)}}function RepLtGt(e){return e=replaceWord2(e,"<","&lt;",!0),e=replaceWord2(e,">","&gt;",!0)}function replaceWord2(e,t,n,l){l||(t=regexEscape(t));let a=RegExp(t,"ig");return e=e.replace(a,n)}function replaceGlobally(e,t,n){let l=RegExp(t,"gi");return e.replace(l,n)}function isDelimiter(e){return"."==e||"!"==e||"?"==e||"\n"==e}function nextParentsElement(e,t){var n=null;let l=null;for(var a=0;a<spanxLocations.length-1;a++)if(spanxLocations[a+1]-1<=wordsToNodes[e]);else if(null==n)n=getNodeByIndx(a);else if(null!=(compareTo=getNodeByIndx(a))){if(compareTo.parentNode!=n.parentNode)return nodesToWords[spanxLocations[a]]-e-2;l=nodesToWords[spanxLocations[a]]-e-2;if(t.substring(0,l+3).match(/[!?.](?:[^0-9a-z])?\n/gi))return l}return a==spanxLocations.length-1?(outputWhatIsBeingRead&&console.log(x.length-e-1),x.length-e-1):l}function getNodeByIndx(e){mappingMultipleNodes=!0;var t=spanidOfAlldescendants[e];return lastDoc&&lastDoc.firstChild&&lastDoc.firstChild===alldescendants[t]?alldescendants[t].parentNode:t>=0&&alldescendants[t]&&trimmer(alldescendants[t].nodeValue).length>0&&alldescendants[t].nodeValue.trim().length>0?(mappingMultipleNodes=!1,alldescendants[t]):(mappingMultipleNodes=!1,null)}function getIndex(e,t){let n=null,l=/(?<![A-Z][a-z]{1,2})(?:\! [^a-z|^0-9]|\? [^a-z|^0-9]|\. [^\.|^a-z|^0-9])|(\."|\?|\!|\n)/;if(null!=voiceName.match(/google/gi)){if(_maximumChars=250,readMultipleNodes){var a,r=e.substring(t);return null!=(n=l.exec(r))&&null!=n.index?(a=isLongerthan(e,n.index,_maximumChars,t),a=ifEndsinQuotes(e,a)):(a=isLongerthan(e,e.length-t,_maximumChars,t),a=ifEndsinQuotes(e,a))}}else _maximumChars=700;if(!NotOnboundary&&readMultipleNodes){l=/\n/;var r=e.substring(t);if(null!=(n=l.exec(r))&&null!=n.index){let o=nextParentsElement(t-1,r),s=r.substring(0,n.index+3).match(/[!?.](?:[^0-9a-z])?\n/gi);o&&n.index+1<o&&!s&&(n.index=o)}return null!=n&&null!=n.index?(a=isLongerthan(e,n.index,_maximumChars,t),a=ifEndsinQuotes(e,a)):(a=isLongerthan(e,e.length-t,_maximumChars,t),a=ifEndsinQuotes(e,a))}if(t=t||0,n=null,readMultipleNodes){t>0&&!isDelimiter(e.charAt(t-1))&&(t-=1);var r=replaceGlobally(e.substring(t,t+_maximumChars+100),spaceAlternative," ");n=l.exec(r)}else n=l.exec(e.substring(t,t+_maximumChars+100));var u=t;if(a=-1,null!=n&&null!=n.index&&(a=isLongerthan(e,n.index,_maximumChars,t),a=ifEndsinQuotes(e,a)),readMultipleNodes&&nodesToWords)loop1:for(var d=0;d<spanxLocations.length;d++){if(nodesToWords[spanxLocations[d]]<0||u>nodesToWords[spanxLocations[d]]);else{if(a<0){var c=e.length-t;a=isLongerthan(e,c,_maximumChars,t),a=ifEndsinQuotes(e,a)}u=isLongerthan(e,(u=nodesToWords[spanxLocations[d]])-t-1,_maximumChars,t);break loop1}if(d==spanxLocations.length-1)return isLongerthan(e,e.length-t-1,_maximumChars,t)}else loop1:for(var d=0;d<spanxLocations.length;d++){if(u>spanxLocations[d]);else{u=isLongerthan(e,(u=spanxLocations[d])-t-1,_maximumChars,t);break loop1}if(d==spanxLocations.length-1)return isLongerthan(e,e.length-t,_maximumChars,t)}return -1!=a&&(readMultipleNodes||a<=u)?a:isNaN(u)?isLongerthan(e,e.length-t,_maximumChars,t):readMultipleNodes&&nodesToWords?isLongerthan(e,e.length-t,_maximumChars,t):u}function isLongerthan(e,t,n,l){if(t>n){var a,r;let o=e.substring(l,l+n),s=RegExp(/([\.!?]) |(\.!?)$/,"gm");for(;null!==(r=s.exec(o));)r.index===s.lastIndex&&s.lastIndex++,a=r;if(a&&a.index>1)return l+a.index+1}return isLongerthan2(e,t,n,l)}function isLongerthan2(e,t,n,l){if(!(t>n))return t+l+1;var a,r=e.substring(l,l+n),o=Math.max(Math.max(r.lastIndexOf(", "),r.lastIndexOf(". ")),Math.max(r.lastIndexOf("! "),r.lastIndexOf("? ")));return(-1==o&&(o=r.lastIndexOf(" "))&&o>0&&o--,-1!=o)?l+o+1:l+n}function isLetter(e){return 1===e.length&&null!=e.match(/[a-z|0-9]|[\!\.\?]/i)}function ifEndsinQuotes(e,t){return t>0&&"\n"==e.charAt(t-1)?t-1:"\n"==e.charAt(t-1)?t:" "!=e.charAt(t)&&" "==e.charAt(t+1)?t+1:t}function addXLength(e){_mapping_xLength&&(_ultra_xLength+=e)}var allEventNodes=[],alldescendants=[],allowBR=!1;function recurseAndAdd(e,t,n=!1,l=!1){var a=e.childNodes,r=0;if(null==a||0==a.length)!l&&(allowBR&&e.nodeName.match(/\bbr\b|\bp\b/gi)||null!=e.nodeValue&&(r=trimmer(e.nodeValue).length)>0)&&(addXLength(r),l||t.push(e));else if(!1==isItHidden(e))for(let o=0;o<a.length;o++)a[o].shadowRoot&&(recurseAndAdd(a[o].shadowRoot,t,!0,l),l&&t.push(a[o])),recurseAndAdd(a[o],t,n,l)}function findShadowChild(e,t){let n=!1;0==shadow_descendants.length&&(recurseAndAdd(e,shadow_descendants,!1,!0),n=!0);for(let l=0;l<2;l++){for(let a=0;a<shadow_descendants.length;a++)if(shadow_descendants[a].shadowRoot){let r=shadow_descendants[a].shadowRoot.getSelection();if(r?.anchorNode?.nodeValue!=null)return r}if(n)break;recurseAndAdd(e,shadow_descendants=[],!1,!0),n=!0}return t}function walkDOM2(e,t){for(var n=[e];n.length>0;){var l=n.pop(),a=l.childNodes,r=0;(null==a||0==a.length)&&(allowBR&&l.nodeName.match(/\bbr\b|\bp\b/gi)||null!=l.nodeValue&&(r=trimmer(l.nodeValue).length)>0)&&(addXLength(r),t.push(l));for(var o=l.childNodes.length-1;o>=0;o--)l.childNodes[o].shadowRoot&&n.push(l.childNodes[o].shadowRoot),n.push(l.childNodes[o])}}function isAlreadyInArray(e,t){for(var n=0,l=t.length;n<l;n++)if(t[n]===e)return;t.push(e)}function strip(e){return new DOMParser().parseFromString(e,"text/html").body.textContent||""}function partialNode(e,t,n,l){let a=createSpan(n);var r=l.cloneNode(!1);return r.nodeValue=t,a.appendChild(r),insertAfter(e,a),a}function checker(e){var t=["select","script","option","input","title"];!1==allowSVG&&t.push("svg");for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return!1;return!0}function isItHidden(e){try{if(e.nodeName&&e.nodeName.match(/\bbr\b/gi))return!1;if(e.nodeType===Node.COMMENT_NODE||e instanceof HTMLElement&&(!1==readAriaHidden&&"true"==e.getAttribute("aria-hidden")||"none"===window.getComputedStyle(e).display||"hidden"===window.getComputedStyle(e).visibility))return!0}catch(t){}return!1}function createSpan(e){var t=document.createElement("customreadxspan");return t.setAttribute("id","ttsh"+e),setInheritColor(t),t}function setInheritColor(e){try{e.style.color="inherit"}catch(t){}}function mapNodesFromRootVal(e,t){if(document&&document.body&&document.body.children)for(let n=0;n<e.length;n++){var l;e[n].shadowRoot&&recurseAndAdd(l=e[n].shadowRoot,t,!0),!1==isItHidden(l=e[n])&&checker(l.tagName.toLowerCase())&&recurseAndAdd(l,t)}}function getNextTarget(e){for(var t=_ultra_index;t<_ultra_descendants.length;t++){var n=-1;if(0==_ultra_index?e==_ultra_descendants[t].parentNode||e==_ultra_descendants[t]||isBookMark(_ultra_descendants[t])?n=t:_ultra_xLengthRead+=trimmer(_ultra_descendants[t].nodeValue).length:n=_ultra_index,n>=0)return null!=(values=traverseTargets(n))[1]&&(_ultra_index=values[1]),values}return null}function hasWhiteSpaceStyle(e){return!1}function checkAllParents(e){if(allowSVG&&traverseTagName(e.parentNode,/\bsvg\b/gi)&&e.parentNode.tagName.match(/\bstyle\b/gi))return!0;for(;null!=e;){if(!0==isItHidden(e)||e.tagName&&!1==checker(e.tagName.toLowerCase()))return!0;e=e.parentNode}}function insertListToTail(e,t=0){extra={nodeIndex:_allDescendantsCounter};for(var n=0;n<e.length;n++){let l=t;t<0&&(l=0),_globalLinkedList.insertToTail(e.substring(n,n+1),l,extra),t++}}function traverseTargets(e,t=!0){for(var n=_ultra_descendants,l=e;l<n.length;l++)if(!checkAllParents(n[l]))try{if(n[l].nodeName.match(/\bp\b/gi))return t&&(constantlyChangingContent&&(_ultra_Xstr+="\n"),insertListToTail("\n")),[n[l],l+1,"\n"];if(n[l].nodeName.match(/\bbr\b/gi)){let a="\n";return"none"===window.getComputedStyle(n[l]).display&&(a=""),t&&(constantlyChangingContent&&(_ultra_Xstr+=a),insertListToTail(a)),[n[l],l+1,a]}if(n[l]&&n[l].nodeValue){var r=n[l].nodeValue,o="";if(t&&(o=nodeReplace(r,n[l]).added),hasWhiteSpaceStyle(n[l])||(r=replaceGlobally(r,"\n"," ")),trimmer(r).length>0){var s="";return" "!=r&&(trimmer(r,!0).length>0||areThereDelimiters(r))?(" "!=r.replace(/\s{2,}/," ")&&(s=newlineSpaceOrNothign(n[l],t)),t&&(constantlyChangingContent&&(_ultra_Xstr+=callReplace(s+r)),s.length>0&&insertListToTail(s),attributeName&&attributeValue&&o.length>0?insertListToTail(o+r+" ...",-1*o.length):insertListToTail(r))):t&&(constantlyChangingContent&&(_ultra_Xstr+=r),insertListToTail(r)),t&&addBuffer(trimmer(n[l].nodeValue).length),r=callReplace(r),t&&(r=nodeReplace(r,n[l]).tmpStr),[n[l],l+1,s,r]}}}catch(u){}return[null,null,null]}function highlightOverlay(e,t){let n=findTopParent(t,/^(?!li|body|head|html).*$/gim),l=n.getBoundingClientRect();e.bottom,e.right;let a=e.left-l.left+"px",r=e.top-l.top+"px",o=e.bottom-e.top,s=e.right-e.left,u=document.getElementById("mytexttospeechhilightdiv");u||(u=document.createElement("div")),u.removeAttribute("style"),u.style&&(u.innerText=" ",u.style.position="relative",u.style.zIndex="1000000",u.style.backgroundColor="#2196F3",u.style.textAlign="center",u.style.border="1px solid #d3d3d3",u.style.left=a,u.style.top=r,u.style.height=o+"px",u.style.width=s+"px",u.style.dsplay="inline-block",u.style.cursor="default",u.style.setProperty("padding","initial"),u.style.opacity="0.5"),u.id="mytexttospeechhilightdiv",n.parentNode.appendChild(u)}function findOut(e,t){return e&&t&&e.length>0&&t.length>0?e[0].bottom+2*e[0].height<t[0].top?"\n":e[0].right>=t[0].left?"":" ":""}function measureChars(e,t){let n=getRangesFromLocation(e,0,1),l=getRangesFromLocation(e,e.nodeValue.length-1,e.nodeValue.length),a=findOut(lastEndRect,n);return t&&(lastEndRect=l),a}function getRangesFromLocation(e,t,n){try{let l=document.createRange();return l.setStart(e,t),l.setEnd(e,n),l.getClientRects()}catch(a){return console.log(a),null}}function newlineSpaceOrNothign(e,t){let n="",l=/\btext\b|\bspan\b|\bstrong\b|\bem\b|\bsup\b|\bi\b|\bcode\b|\ba\b|\bb\b|\btime\b|\bkbd\b|\bmark\b|\bsamp\b|\bsub\b|\bu\b|\bwbr\b|\bvar\b/gi;return e.parentNode.tagName.match(l)?(n=whatToAdd(findTopParent(e,l),t),e.parentNode.tagName.match(/\ba\b/gi)&&(n+=" ")):n=whatToAdd(e,t),n}var added=!1;function computeOverflow(e,t,n,l){let a=e+t,r=!1;if(0==l&&(added=!1),n>0&&0==l){added=!1,overflowArray=[];for(let o=0;o<spanxLocations.length-1&&!(nodesToWords[spanxLocations[o+1]]>beforelastoffset+a+n);o++)nodesToWords[spanxLocations[o+1]]>=beforelastoffset+a-1&&nodesToWords[spanxLocations[o+1]]<=beforelastoffset+a+n&&overflowArray.push(o+1);let s=_ultra_lastRect;_ultra_lastRect=null,extraSpaceValues=countSpacesArray(overflowArray,!0),_ultra_lastRect=s,n-=extraSpaceValues.length}else n>0&&l>0?1==originalHtml.length&&" "==MylinkedList.next.data?(added=!0,n++):(added&&" "!=MylinkedList.next.data&&n--,added=!1):!0==added&&-1==n&&" "!=MylinkedList.next.data&&(r=!0);return{tmpOverflow:n,oneless:r}}function nodeFromIndex(e){var t=spanidOfAlldescendants[e];for(let n=0;n<allSelectedNodes.length;n++)if(allSelectedNodes[n]&&allSelectedNodes[n].firstChild===alldescendants[t])return{node:allSelectedNodes[n].firstChild,id:t};return{node:null,id:t}}function countSpacesArray(e,t){var n,l,a=0,r="";for(let o=0;o<e.length;o++)0==o&&e[o]-1>=0&&(n=countSpaces(l=nodeFromIndex(e[o]-1),t),r+=n.string),n=countSpaces(l=nodeFromIndex(e[o]),t),a+=n.length,r+=n.string;let s=(r.match(/ <readxspace-1337\n>|<readxspace-1337\n> /g)||[]).length;return{length:a-=s,string:r}}function countSpaces(e,t){let n="";a="";let l="";if((el=e.node)&&el.nodeValue){var a=el.nodeValue;if(a=callReplace(a),t&&(a=nodeReplace(a,el).tmpStr),hasWhiteSpaceStyle(el)||(a=replaceGlobally(a,"\n"," ")),trimmer(a).length>0&&" "!=a.replace(/\s{2,}/," ")&&(trimmer(a,!0).length>0||areThereDelimiters(a))){for(el=el.firstChild;el?.parentNode?.tagName?.length>0&&el.parentNode.tagName.match("CUSTOMREADXSPAN");)el=el.parentNode;n=newlineSpaceOrNothign(el,t)}}return n.length>0&&(l="<readxspace-1337\n>"),{length:n.length,string:l+a}}function checkID(e,t){return!!(e&&e.length>0&&e.indexOf(t))}function checkElementAttributes(e){for(el=e.parentNode;el instanceof HTMLElement&&(checkID(el.getAttribute("id"),"ttsh")||checkID(el.getAttribute("id"),"ttshmyHighlight")||checkID(el.getAttribute("id"),"mycustomreadxhspan"));)el=el.parentNode;return!!(el instanceof HTMLElement&&attributeValue&&attributeName&&attributeValue.trim().length>0&&el.getAttribute(attributeName)&&el.getAttribute(attributeName).toLowerCase().indexOf(attributeValue)>=0)}function nodeReplace(e,t){if(!0==checkElementAttributes(t)){let n=window.getComputedStyle(t.parentNode,":before").content,l="x";return(removeNickNames&&(l="o"),n&&n.match(/@/g))?{tmpStr:e,added:""}:(e="ApplyVoiceChange:"+l+" "+e+" ...",{tmpStr:e,added:"ApplyVoiceChange:"+l+" "})}return{tmpStr:e,added:""}}function findTopParent(e,t){for(;e.parentNode.tagName.match(t);)e=e.parentNode;return e}var wasBr=!1;function addBuffer(e){_ultra_xLengthBuffer+=e}function isCurrentItemFollowedByANewLine(){if(_ultra_index>0){var e=traverseTargets(_ultra_index,!1);return!e||null==e[2]||"\n"==e[2]}return!1}function areThereMoreElements(){if(_ultra_index>0){var e=traverseTargets(_ultra_index,!1);return e&&null!=e[2]?{hasMore:!0,values:e}:{hasMore:!1,values:null}}return{hasMore:!0,values:null}}function checkIt(e,t){return!(e.top<0)&&!(t.top<0)&&e.top+e.height/2>=t.top}function theSame(e,t){return e.top==t.top||(e.top<t.top?checkIt(e,t):checkIt(t,e))}function printRect(e){x=e.left,y=e.top,w=e.width,h=e.height,console.log("Left: "+x+", Top: "+y+", Width: "+w+", Height: "+h)}function whatToAdd(e,t=!0){var n="",l=e.parentNode.getBoundingClientRect();return null!=_ultra_lastRect&&(n=_ultra_lastRect==l?"":pointInRect(_ultra_lastRect.left,_ultra_lastRect.top,_ultra_lastRect.right,_ultra_lastRect.bottom,l.left,l.top)?"":_ultra_lastRect.bottom==l.bottom&&pointInRect(l.left,l.top,l.right,l.bottom,_ultra_lastRect.left,_ultra_lastRect.top)?"":theSame(_ultra_lastRect,l)?_ultra_lastRect.left==l.left&&_ultra_lastRect.top==l.top?"":" ":"\n"),t&&(_ultra_lastRect=l),n}function insideCur(e,t){let n=0;for(;null!==e&&n<200;){if(e===t)return!0;n++,e=e.parentNode}return!1}function mapIndexForHighlight(e=!1){!0==readMultipleNodes&&(mappingMultipleNodes=!0,allowBR=!0),_ultrafast=!0,document&&document.body&&document.body.children&&(null!=doc&&removeMyHighlight(),setTargetBufferVariables(),getTargetBuffer(),processKeyValuesForReplace("\\s{2,}",{value:" ",params:"ig"},_globalLinkedList,_globalLinkedList.giveMeTheString()),replaceValuesInList(_globalLinkedList),x=removeEmoji(x=_globalLinkedList.giveMeTheString()),mapSpanX(),outputOriginalText&&(console.log("ORIGINAL TEXT:"),console.log(x)),x=eraseWords(x))}function printUltra(){for(let e=0;e<_ultra_descendants.length;e++)console.log(_ultra_descendants[e].nodeValue)}function setTargetBufferVariables(){if(0==alldescendants.length){var e;_ultra_descendants=[],_ultra_index=0,_ultra_xLength=0,_ultra_xLengthRead=0,_mapping_xLength=!0,mapNodesFromRootVal(document.body.children,_ultra_descendants),_mapping_xLength=!1}else _ultra_xLengthRead+=_ultra_xLengthBuffer;_ultra_xLengthBuffer=0,_ultra_lastRect=null,totalReadStrLen=0,lastReadstr="",fromEnd=!1,alldescendants=[],nodesToWords=[],wordsToNodes=[],_ultra_Xstr="",_globalLinkedList=new LinkedList,_globalLinkedListChildren=[],_allDescendantsCounter=0}function getTargetBuffer(){for(e=0;_curentTarget&&null!=(t=getNextTarget(_curentTarget))&&t&&t[0];e++){!t[0].nodeName.match(/\bbr\b|\bp\b/gi)&&(alldescendants.push(t[0]),_allDescendantsCounter++),_ultra_Loops=e;var e,t,n=traverseTargets(_ultra_index,!1)[0];if(n&&(0==richCaretIndex||!insideCur(n,_curentTarget))&&n.parentNode!==t[0].parentNode){if(constantlyChangingContent){if(t&&4==t.length&&n&&void 0!==t[0].nodeValue&&isCurrentItemFollowedByANewLine()&&isNotEmpty(_ultra_Xstr))break}else if((_ultra_xLengthBuffer>600||_ultra_xLengthBuffer>400&&e>30)&&isCurrentItemFollowedByANewLine())break;else if((_ultra_xLengthBuffer>2500||_ultra_xLengthBuffer>1500&&e>40)&&isCurrentItemFollowedByANewLine())break}}_curentTarget=t,_ultra_Loops=e}function mapSpanX(){var e=0;spanxLocations=[],spanidOfAlldescendants=Array(alldescendants.length).fill(-1),alldescendantsToSpanid=Array(alldescendants.length).fill(-1),wordsToNodes=[],nodesToWords=[];var t=_globalLinkedList?.next,n=-1;let l=0;for(i=0;null!=t;){if(nodesToWords[e]=e,wordsToNodes[e]=e,t?.extra?.nodeIndex!=n){spanxLocations.push(e);let a=l;l++,_globalLinkedListChildren[a]=t,spanidOfAlldescendants[a]=t?.extra?.nodeIndex,alldescendantsToSpanid[t?.extra?.nodeIndex]=a}n=t?.extra?.nodeIndex,t=t.next,e++}nodesToWords[e]=e,wordsToNodes[e]=e,spanxLocations.push(e)}function isThereNoSpace(e,t){return e.charAt(t).match(/\s/)?"\r"==e.charAt(t)||"\n"==e.charAt(t)?2:0:1}function isNotEmpty(e){return trimmer(isItAWord(eraseWords(e),voices[currentVoice].name)).length>0}var isPaused=0;function pauseForAfew(e=400){isPaused=1;var t=setInterval(function(){isPaused=0,clearInterval(t)},e)}function callReplace(e){e=MapForReplace(e).giveMeTheString();var t=RegExp(unified_emoji_ranges.join("|"),"g");return e=!0==readMultipleNodes?e.replace(t,spaceAlternative):e.replace(t," ")}function removeEmoji(e){var t=RegExp(unified_emoji_ranges.join("|"),"g");return e=!0==readMultipleNodes?e.replace(t,spaceAlternative):e.replace(t," ")}function regexEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function replaceWord(e,t,n){if(trimmer(e).length>0){var l=t;let a=RegExp(l,"ig");if(readMultipleNodes&&"\\s+"==l){for(var r,o="",s=0;null!==(r=a.exec(e));){r.index===a.lastIndex&&a.lastIndex++,o+=e.substring(s,r.index),s=a.lastIndex;var u=/\n/;r[0].match(u)?o+="\n":o+=n}return s>0?o+=e.substring(s):e}return e=e.replace(a,n)}return""}function insertAfter(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function trimmer(e,t=!1,n){if(null==e)return"";if(" "==e.replace(/\s+/," "))return" ";var l=e.replace(/[\s\.\'\?"!\u2026\u201C\u201D\u2018\u2019\u200B]*/g,"");return!1==t&&l.length<=0&&!0==readMultipleNodes&&!0==mappingMultipleNodes&&(e.match(/[\.\?\!'" ]|[\u2018\u2019\u201A\u201B\u2032\u2035]|[\u201C\u201D\u201E\u201F\u2033\u2036]/)||n&&e.match(n))?" ":l}function areThereDelimiters(e){return!!e.match(/[\.\?\!'"]|[\u2018\u2019\u201A\u201B\u2032\u2035]|[\u201C\u201D\u201E\u201F\u2033\u2036]/)}function wrap(e,t){try{e.parentNode.insertBefore(t,e),t.appendChild(e)}catch(n){lastDoc=null,doc=null,console.log(n)}}function pause(){canceled=!0,allSelectedNodes&&allSelectedNodes.length>0?addDialogToNode(allSelectedNodes[allSelectedNodes.length-1]):null!=lastDoc&&addDialogToNode(lastDoc),bookmarkPauseLocation(),window.speechSynthesis.cancel(),sendMessageToBackground("paused")}function isBookMark(e){return!!_ultrafast&&trimmer(e.nodeValue).length>0&&trimmer(bookmarkString).length>0&&e.nodeValue==bookmarkString&&(bookmarkString="",!0)}function bookmarkPauseLocation(){saveBookmarkToStorage(window.location.href,childsNodeValue)}function saveBookmarkToStorage(e,t){!(trimmer(e).length>2500)&&!(trimmer(t).length>2500)&&chrome.storage.local.get({storedUrlArray:{},indexedArray:[]},function(n){urlArray=n.storedUrlArray,indexedArray=pushKey(indexedArray=n.indexedArray,e,urlArray),urlArray[e]=t,chrome.storage.local.set({storedUrlArray:urlArray,indexedArray:indexedArray})})}function pushKey(e,t,n){var l=[],a=0;for(let r=0;null!=e&&r<e.length;r++)e[r]==t||(l[a]=e[r],a++);if(l.push(t),l.length>250){let o=l.shift();delete n[o]}return l}var bookmarkString="",pressedOnBookmarkOrPlay=!1;function getBookmarkFromStorage(e){chrome.storage.local.get({storedUrlArray:{}},function(t){bookmarkString=(urlArray=t.storedUrlArray)[e],changeSpeechCircleColor()})}function changeSpeechCircleColor(){try{speechCircle&&speechCircle.style&&("rgb(27, 73, 228)"!=speechCircle.style.backgroundColor&&readMultipleNodes?!1==pressedOnBookmarkOrPlay&&trimmer(bookmarkString).length>0&&(speechCircle.style.backgroundColor="#1B49E4"):speechCircle.style.backgroundColor="#2196F3"),!inIframe()&&oncePerPage&&!1==pressedOnBookmarkOrPlay&&!trimmer(bookmarkString).length>0&&(speechCircle.style.backgroundColor="green",setTimeout(function(){animateCountdown(2.85)},150))}catch(e){console.log(e)}}var supressDialog=!1;function addDialogToNode(e){if(!supressDialog&&e instanceof HTMLElement)try{var t=document.createElement("BUTTON");t.innerHTML="...",t.addEventListener("click",openDialog),e.appendChild(t),Mydialog=document.createElement("DIALOG");var n=document.createElement("form"),l=document.createTextNode("Change Voice"),a=document.createElement("P"),r=document.createElement("select"),o=document.createElement("MENU"),s=document.createElement("BUTTON"),u=document.createElement("BUTTON"),d=document.createElement("span"),c=document.createElement("input");n.setAttribute("method","dialog"),a.innerText="",Mydialog.setAttribute("style","font-size:initial;transform:translate(0, -50%);top:50%;margin:0 auto;"),o.setAttribute("style","text-align: right"),s.innerHTML="OK",s.value=currentVoice,u.innerHTML="Cancel",u.value="cancel",d.innerText=speechRate,c.type="range",c.min="50",c.max="200",c.value=100*speechRate,c.step="10",Mydialog.appendChild(n),n.appendChild(l),n.appendChild(a),n.appendChild(r),n.appendChild(a.cloneNode()),n.appendChild(c),n.appendChild(d),o.appendChild(s),o.appendChild(document.createTextNode(" ")),o.appendChild(u),n.appendChild(o),e.appendChild(Mydialog),c.addEventListener("input",function(){d.innerHTML=this.value/100}),r.addEventListener("change",function e(t){s.value=r.value}),Mydialog.addEventListener("close",function e(){dialogIsOpen=!1,"cancel"!=Mydialog.returnValue&&(speechRate=d.innerHTML,""!==Mydialog.returnValue&&(currentVoice=Mydialog.returnValue,voiceName=regexEscape(voices[Mydialog.returnValue].name)),savePresets())});for(var g=0;g<voices.length;g++){currentVoice=selectVoice(voiceName,0);var $=document.createElement("option");$.setAttribute("value",g),$.text=voices[g].name,r.appendChild($),g==currentVoice&&($.selected="true")}}catch(f){console.log(f)}}function IsLink(e,t=!1){if(!1==canceled)return!1;for(var n=0;e;){var l=e.tagName,a="";if(l&&(a=l.toLowerCase()),++n>=10||"body"===a||"html"===a)break;if("textarea"===a||"button"===a||"input"===a||"a"==a||!1==t&&e.nodeType<3&&e.hasAttribute("onclick"))return!0;e&&(e=e.parentNode)}return!1}function sendMessageToBackground(e){"paused"==e&&(window.onbeforeunload=null),chrome.runtime.sendMessage({greeting:e},e=>{chrome.runtime.lastError})}var addonisEnabled=!1;function clickHandler(e){if(!(!1==canClick||e.target==speechCircle||Math.abs(e.pageX-xloc)>10||Math.abs(e.pageY-yloc)>10)&&0==isPaused)try{!1==canceled?sendClick(e):chrome.storage.local.get({onOff:"off",isPlaying:"off"},function(t){"off"!==t.onOff&&"off"==t.isPlaying&&(wasDragged=!1,"dblclick"==e.type?!1==IsLink(e.target,!0)&&(hasSelection()&&null!=getWordClicked()?sendClick(null,window.getSelection().anchorNode.parentNode):sendClick(e)):!1==useDoubleClick&&sendClick(e))})}catch(t){console.log(t)}}function fillEventNodes(e){allEventNodes=[];var t=document.elementFromPoint(e.x,e.y);t&&recurseAndAdd(t,allEventNodes),(t=document.elementsFromPoint(e.x,e.y))&&t.length>1&&recurseAndAdd(t[1],allEventNodes);for(var n=0;n<e.target.childNodes.length;n++)recurseAndAdd(e.target.childNodes[n],allEventNodes)}function findTrigger(e=alldescendants){var t=-1;if(null==e||!alldescendantsToSpanid)return t;loop1:for(var n=0,l=e.length;n<l;n++)for(var a=0,r=allEventNodes.length;a<r;a++)if(allEventNodes[a]===e[n]&&-1!=alldescendantsToSpanid[n]){alldescendantsToSpanid[n]&&(t=alldescendantsToSpanid[n]),alldescendantsToSpanid[n]||(t=n);break loop1}return t}function shouldDeepScan(){return!0!=_ultrafast||-1==findTrigger(_ultra_descendants)||(_ultra_index=0,_ultra_xLengthRead=0,_ultra_xLengthBuffer=0,_ultra_lastRect=null,!1)}function hasSelection(){if(!0==wasDragged)return!1;if((selection=window.getSelection())&&selection.rangeCount>0||null!=selection.focusNode&&null!=selection.anchorNode&&0==selection.getRangeAt(0).startOffset&&0==selection.getRangeAt(0).endOffset){if(null!=selection.anchorNode&&0==Math.abs(selection.getRangeAt(0).startOffset-selection.getRangeAt(0).endOffset)&&null==selection.anchorNode.nodeValue&&(null==selection.anchorNode.nodeValue&&(selection=findShadowChild(selection.anchorNode,selection)),!myHilightSpan))return!0;var e=selection.getRangeAt(0);if(Math.abs(e.endOffset-e.startOffset)>0)return!0}return!1}function compareSelectionPosition(e){return 2==e.anchorNode.compareDocumentPosition(e.focusNode)?1:0}function getWordClicked(){if((selection=window.getSelection())&&selection.rangeCount>0||null!=selection.anchorNode&&0==selection.getRangeAt(0).startOffset&&0==selection.getRangeAt(0).endOffset){null==selection.anchorNode.nodeValue&&(selection=findShadowChild(selection.anchorNode,selection));var e=selection.getRangeAt(0),t=[selection.anchorNode,selection.focusNode][compareSelectionPosition(selection)],n=e.startOffset;if((allEventNodes=[]).push(t),(null!=doc&&isHilightSpan(t)||isHilightSpan(selection.focusNode))&&((allEventNodes=[]).push(doc.firstChild),n=0),t&&t.textContent&&t.textContent.length>0){var l=t.textContent.substring(0,n),a=l.length,r=(l=callReplace(l)).length;n-=a-r}var o=/\s+/;if(trigger=findTrigger(),""==t.textContent&&trigger<0)return null;if(trigger>=0&&n>0){for(;trigger>=0&&n>0&&!l.charAt(n).match(o);)n--;l.charAt(n).match(o)&&n++}return richCaretIndex=spanxLocations[trigger]+n,readMultipleNodes&&nodesToWords&&(richCaretIndex=nodesToWords[richCaretIndex]),t}return null}function findElementByYCoordinateInsideEventNode(e){try{for(var t=0;t<allEventNodes.length;t++){var n=allEventNodes[t],l=document.createRange();l.selectNodeContents(n);var a=l.getClientRects();if(a.length>0&&a[0].bottom>e){var r=allEventNodes[t];let o=allEventNodes[0].parentNode.getBoundingClientRect();if(0!=o.height&&o.bottom<a[0].bottom&&" "!=allEventNodes[0].nodeValue.replace(/\s{2,}/," ")&&(r=allEventNodes[0]),!isItHidden(r))return(allEventNodes=[]).push(r),r}}}catch(s){return}}document.addEventListener("click",clickHandler),document.addEventListener("dblclick",clickHandler),document.addEventListener("mousedown",e=>{xloc=e.pageX,yloc=e.pageY});const pointInRect=(e,t,n,l,a,r)=>a>e&&a<n&&r>t&&r<l;function sendClick(e,t=null,n=0){if(0==n){if(null!=e){if("dblclick"!=e.type&&IsLink(e.target))return;fillEventNodes(e),void 0!=(t=findElementByYCoordinateInsideEventNode(e.y))&&(e=null,clearSelection())}else if(null!=t&&"bookmark"!=t[0]){allEventNodes=[];for(var l=0;l<t.length;l++)recurseAndAdd(t[l],allEventNodes);let a=findElementByYCoordinateInsideEventNode(py);t=void 0==a?allEventNodes[0]:a}Array.isArray(t)&&"bookmark"==t[0]&&(t=t[0])}if(hasSelection()){let r=getWordClicked();r&&(t=r)}let o=findTrigger();"bookmark"==t&&_ultra_descendants&&null!=_ultra_descendants[0]&&(o=0),"bookmark"!=t&&(bookmarkString=""),t||null==e||(t=e.target);var s=isHilightSpan(t);if(rescan&&0==n&&!1==dialogIsOpen&&!0==canceled&&!1==s&&(o=-1),!1==dialogIsOpen&&-1==o&&!0==canceled&&!1==s&&0==n&&(null!=t||null==x)){_curentTarget=t,Array.isArray(t)&&(_curentTarget=t[0]),rescan||shouldDeepScan()?updateIndexes(10,!0):mapIndexForHighlight(),sendClick(e,t,1);return}if(e&&t.id.indexOf("ttsh")>=0||s)togglePlayButton();else{if(!0==canceled&&!e&&hasSelection()&&getWordClicked()){togglePlayButton();return}!0==canceled&&o>=0?(window.speechSynthesis.cancel(),clickorendHighlightReset(),richCaretIndex=spanxLocations[o],readMultipleNodes&&nodesToWords&&(richCaretIndex=nodesToWords[richCaretIndex]),readText(),clearSelection()):!1==canceled&&(canceled=!0,unHilight(),window.speechSynthesis.cancel(),sendMessageToBackground("paused"),clickorendHighlightReset(),clearSelection())}}function clearSelection(){window.getSelection().removeAllRanges()}function isHilightSpan(e){return!!myHilightSpan&&!!e&&!!e.parentNode&&(e===myHilightSpan||e.parentNode===myHilightSpan||!!e.parentNode&&e.parentNode.parentNode===myHilightSpan)}function togglePlayButton(){clearSelection(),!0==canceled?docsFirstChild&&null==x&&_ultrafast&&0!=_ultra_index?playAfterOptionsUpdate():readText():pause()}var extentionIsOn=!1;function logKey(e){if(!1==spacebarValue)return;""!=playPauseShortcutKey||inIframe()||(playPauseShortcutKey="Space");let t=playPauseShortcutKey?.toLowerCase(),n=t?.indexOf("alt")>=0,l=t?.indexOf("ctrl")>=0,a=t?.split("+")?.pop()?.trim();if(playPauseShortcutKey&&a?.length>0&&!(n!=e.altKey)&&!(l!=e.ctrlKey)&&(e.key.toLowerCase()===a||e.code?.toLowerCase()==a)&&(!1==defaultKey||e.target==document.body||e.target==document.body.parentNode)&&(!1==canceled?(e.preventDefault(),togglePlayButton()):(extentionIsOn&&(hasSelection()||0!=lastoffset||autoPlayThisSite(!1))&&e.preventDefault(),spaceBarWasPressed())),checkShortcutKey(nextParagraphShortcut,e)&&!1==canceled&&(supressDialog=!0,togglePlayButton(),setTimeout(()=>{canceled=!1,myOnEnd(null),supressDialog=!1},250)),checkShortcutKey(lastParagraphShortcut,e)&&!1==canceled&&lastParagraphs.length>1){supressHighlight=!0,togglePlayButton(),updateIndexes(10,!0);let r=[];lastParagraphs.pop(),r.push(lastParagraphs.pop()),sendClick(null,r),supressHighlight=!1}}function checkShortcutKey(e,t){return checkForAlt=(lps=e?.toLowerCase())?.indexOf("alt")>=0,checkForCtrl=lps?.indexOf("ctrl")>=0,key=lps?.split("+")?.pop()?.trim(),!!(e&&key?.length>=1)&&!(checkForAlt!=t.altKey)&&!(checkForCtrl!=t.ctrlKey)&&t.key.toLowerCase()===key}function spaceBarWasPressed(){chrome.storage.local.get({onOff:"off",isPlaying:"off"},function(e){updateDragged(!1),"off"!==e.onOff&&"off"==e.isPlaying&&(hasSelection()?sendClick(null,window.getSelection().anchorNode.parentNode):autoPlayThisSite(!1)?sendClick(null,autoPlayThisSite()):togglePlayButton())})}function autoPlayThisSite(e=!0){if(!1==pressedOnBookmarkOrPlay){let t=window.location.href;for(let[n,l]of Object.entries(autoPlayList)){let a=RegExp(n);if(t.match(a))return autoPlay(l,e)}}return!1}function autoPlay(e,t=!0){return t?(pressedOnBookmarkOrPlay=!0,[document.getElementsByClassName(e)[0]]):null!=document.getElementsByClassName(e)[0]}var interval=setInterval(function(){(voices=speechSynthesis.getVoices()).length&&clearInterval(interval)},100),dialogIsOpen=!1;function openDialog(e){e.preventDefault(),null!=Mydialog&&(dialogIsOpen=!0,e.target.blur(),Mydialog.showModal())}function savePresets(){chrome.storage.local.set({voiceIndex:currentVoice,voiceName:voiceName,voiceSeed:100*speechRate})}function update(){null!=doc&&removeMyHighlight(),alldescendants=[],nodesToWords=[],wordsToNodes=[],mapIndexForHighlight(),hasSelection()||!1!=canceled?hasSelection()||null==lastDoc||!1!=supressHighlight||highlight(!1):highlight()}var updating=0;function updateIndexes(e=2e3,t=!1){update()}function processClickEventFromMessage(e,t){if(!1==canceled||t&&null!=lastDoc)togglePlayButton();else{let n=[];n.push(_ultra_descendants[e].parentNode),sendClick(null,n)}}function saveSpaceToPlayselection(e){chrome.storage.local.get({spacetoplay:""},function(t){let n,l=window.location.href.match(/.*?\w+\//);var a=RegExp("\n?"+l+"=>.*","ig");spacetoplay=(spacetoplay=t.spacetoplay).replace(a,""),spacetoplay+="\n"+l+"=>"+e,spacetoplay=spacetoplay.trim(),chrome.storage.local.set({spacetoplay:spacetoplay})})}function isString(e){return"string"==typeof e||e instanceof String}function CheckHref(e){if(void 0!=e.href||null!=e.href)return isString(e.href)?{value:"",href:e.href}:{value:"",href:void 0};if(void 0==e.href&&e.children.length>0){for(let t=0;t<e.children.length;t++)if(void 0!=e.children[t].href){if(isString(e.children[t].href))return{value:" :nth-child("+(t+1)+")",href:e.children[t].href};return{value:" :nth-child("+(t+1)+")",href:void 0}}}return{value:"",href:""}}function saveAutoPlayselection(e,t){if(void 0==t){alert("The element\n"+e+"\nis not a valid choice");return}void 0!=t&&t.length>30&&(t=(t=t.substring(0,30)).trim().replace(/\n/gm,""));let n=window.location.href,l="",a=n,r="",o=n.match(/.*?\w+\//)+"",s=document.querySelectorAll("."+e.replace(/ /g,"."));for(let u=0;u<s.length;u++)if(void 0==t||t.trim().indexOf(s[u].innerText.trim())>=0){let d=CheckHref(s[u]);l=d.href,r=d.value;break}if(void 0!=l&&l.length>0&&0==l.indexOf(o)){let c=o.length;for(let g=o.length;g<n.length&&g<l.length&&n[g]==l[g];g++)"/"==n[g]&&(c=g+1),a=n.substring(0,c)}else{a=n,alert("URL not found in \n"+e);return}if(a==n){alert("URL did not match current page url template\n\n"+l);return}chrome.storage.local.get({autoplay:""},function(n){var l=RegExp("\n?"+a+"=>.*","ig");let o=n.autoplay;o=o.replace(l,""),o+="\n"+a+"=>."+e.replace(/ /g,".")+r+"=>"+t,o=o.trim(),chrome.storage.local.set({autoplay:o})})}function mouselistener(e){let t=verifyTarget(e);document.getElementsByClassName("highlight-wrap").length,applyMask(t)}function verifyTarget(e){var t=document.elementsFromPoint(e.x,e.y),n=t[0];for(let l=0;l<t.length;l++)if(null!=t[l].className&&"highlight-wrap"!=t[l].className&&""!=t[l].className){n=t[l];break}return n}function applyMask(e){let t=!0;if(document.getElementsByClassName("highlight-wrap").length>0?t=resizeMask(e):createMask(e),!t)return;var n=document.getElementsByClassName("highlight-wrap")[0];let l=document.getElementsByClassName(e.className)[0]==e;0==requestType&&(""==e.className||!1==l)||1==requestType&&void 0==CheckHref(e).href?n.style.backgroundColor="#FF0000":n.style.backgroundColor="#205081"}function resizeMask(e){if(e&&void 0!==e.getBoundingClientRect()){var t=e.getBoundingClientRect(),n=document.getElementsByClassName("highlight-wrap")[0];return n.style.top=t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",!0}return!1}function createMask(e){var t=e.getBoundingClientRect(),n=document.createElement("div");n.className="highlight-wrap",n.style.position="fixed",n.style.top=t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",n.style.backgroundColor="#205081",n.style.opacity="0.5",n.style.cursor="default",n.style.zIndex="9000000",document.body.appendChild(n),n.addEventListener("click",function(e){var t=verifyTarget(e);return 0==requestType?saveSpaceToPlayselection(t.getAttribute("class")):1==requestType&&saveAutoPlayselection(t.getAttribute("class"),t.innerText),window.removeEventListener("mousemove",mouselistener),clearMasks(),!1})}function clearMasks(){var e=document.getElementsByClassName("highlight-wrap").length,t=document.getElementsByClassName("highlight-wrap");if(e>0)for(var n=0;n<e;n++)t[n].remove()}function showElement(e){e&&e.style&&(e.style.visibility="visible",document.body.append(e),dragElement(speechCircle))}function hideElement(e){e&&e.style&&(e.style.visibility="hidden",document.body.contains(e)&&document.body.removeChild(e))}function inIframe(){try{return window.self!==window.top}catch(e){return!0}}function loadDelayedPresets(){var e=1e3;inIframe()&&(e=3e3);var t=setInterval(function(){!1==ranAtLeastOnce&&(firstCallFromLoaded=!0,loadPresets()),clearInterval(t)},e)}chrome.runtime.onMessage.addListener(function(e,t,n){if("on end"==e.toSay){myOnEnd();return}if(null!=e.onBoundary){if(!1==canceled){let l=e.onBoundary.split(" ");myOnBoundary({charIndex:parseInt(l[0]),charLength:parseInt(l[1])})}return}let a=e.greeting;if(a.match(/\[url\]=>/gim)){let r=e.greeting.split("[url]=>");a=r[0],_currentURL=r[1]}if("update"==a)0==updating&&loadDelayedPresets(),n(!0);else if(a.match(/readx extramessage/gim)){let o=a.match(/(?<=<id:>)\d+/);if(o&&o[0]!=myHandle)return;let s=a.match(/(?<=<words:>).+/);var u=null;s&&(u=RegExp(s[0],"gmi")),!0==canceled&&(o&&u||0==_ultra_descendants.length)&&(removeMultipleNodeHilights(),alldescendants=[],setTargetBufferVariables());let d="";for(let c=0;c<_ultra_descendants.length;c++)if(!checkAllParents(_ultra_descendants[c])){if(!o){let g=_ultra_descendants[c].nodeValue;trimmer(g).length>0&&(d+=g.trim()+" ",(d=d.replace(/\s{2,}/g," ")).length>300&&(c=_ultra_descendants.length+1))}if(o&&o[0]==myHandle){if(s&&u){if(null!=_ultra_descendants[c].nodeValue&&_ultra_descendants[c].nodeValue.match(u)){processClickEventFromMessage(c,!1);return}}else{processClickEventFromMessage(c,!0);return}}}if(s&&u&&!1==canceled&&processClickEventFromMessage(null,!0),d=d.replace(/\s{2,}/g," "),!o&&d.trim().length>40){null==myHandle&&(myHandle=randonNumber());sendMessageToBackground("readx replytoextramessage"+("ID: "+myHandle+"\n")+d.trim()+"\n")}}else"update readx"==a?loadPresets():a.match(/readx select/gim)?inIframe()||(a.match(/spacetoplay/gim)?requestType=0:a.match(/autoplay/gim)&&(requestType=1),a.match(/nothing/gim)?(window.removeEventListener("mousemove",mouselistener),clearMasks()):window.addEventListener("mousemove",mouselistener)):"play-selection"==a?hasSelection()&&sendClick(null,window.getSelection().anchorNode.parentNode):"it's on"==a?(!1==firstCallFromLoaded&&(firstCallFromLoaded=!0),loadPresets(),extentionIsOn=!0,addonisEnabled=!0):"it's off"==a?(extentionIsOn=!1,hideElement(speechCircle)):"off was pressed"==a?(extentionIsOn=!1,hideElement(speechCircle)):"on was pressed"==a&&(chrome.storage.local.get({slideValue:!1},function(e){!0==e.slideValue&&showElement(speechCircle)}),inIframe()&&(document.addEventListener("click",clickHandler),document.addEventListener("dblclick",clickHandler)),extentionIsOn=!0)});var replaceLen=null,firstCallFromLoaded=!1;function loadPresets(){if(!1!=firstCallFromLoaded){ranAtLeastOnce=!0;var e="Microsoft Aria Online";isEdge||(e="Google US"),chrome.storage.local.get({voiceIndex:"10",voiceName:e,voiceSeed:100,replaceStr:"",blacklist:"",spacetoplay:"",autoplay:"",divhilight:!1,yhighlightonly:!0,clickValue:!0,slideValue:!0,dragsizeValue:"30",continousValue:!0,spacebarValue:!0,autoscrollValue:!0,useDoubleClick:!0,rescan:!1},function(e){processPresetList(e)})}}function processPresetList(e){var t="",n="",l="";if(isBlacklisted(e.blacklist.split(/\r?\n/))&&(!0!=canceled&&(pause(),removeMultipleNodeHilights()),e.replaceStr="",e.spacetoplay="",e.autoplay="",e.clickValue=!1,e.slideValue=!1,e.spacebarValue=!1),canClick=e.clickValue,useDoubleClick=e.useDoubleClick,hasspeechCircle=e.slideValue,rescan=e.rescan,e.continousValue=!0,readMultipleNodes!=e.continousValue&&(nodesToWords&&removeMultipleNodeHilights(),nodesToWords=[],wordsToNodes=[],alldescendants=[],x&&x.length>0&&!1==canceled&&(x="",pause()),removeMyHighlight(),clickorendHighlightReset()),readMultipleNodes=e.continousValue,autoscroll=e.autoscrollValue,speechCircle&&hasspeechCircle&&speechCircle.style&&(speechCircle.style.visibility="visible",speechCircle.style.lineHeight=e.dragsizeValue+"px",speechCircle.style.height=e.dragsizeValue+"px",speechCircle.style.width=e.dragsizeValue+"px",dragsizeValue=parseInt(e.dragsizeValue),(!inIframe()||inIframe()&&document.body&&document.body.children.length>1)&&document.body.appendChild(speechCircle)),speechCircle&&loaded&&(hasspeechCircle||hideElement(speechCircle),hasspeechCircle&&checkIfOn()),!loaded&&!0==e.slideValue){if(loaded=!0,speechCircle=document.createElement("div"),inIframe()?(circletop="10px",circlebottom=null,circleleft=null,circleright="10px",speechCircle.style&&(speechCircle.style.opacity="0.1")):speechCircle.style&&(speechCircle.style.opacity="0.5"),speechCircle.style){speechCircle.innerText=" ",speechCircle.style.position="fixed",speechCircle.style.zIndex="1000000",speechCircle.style.backgroundColor="#2196F3",speechCircle.style.textAlign="center",speechCircle.style.border="1px solid #d3d3d3",speechCircle.style.bottom=circlebottom,speechCircle.style.right=circleright,speechCircle.style.left=circleleft,speechCircle.style.top=circletop,speechCircle.style.lineHeight=e.dragsizeValue+"px",speechCircle.style.height=e.dragsizeValue+"px",speechCircle.style.width=e.dragsizeValue+"px",speechCircle.style.dsplay="inline-block",speechCircle.style.cursor="default",speechCircle.style.setProperty("border-radius","25%","important"),speechCircle.style.setProperty("padding","initial"),dragsizeValue=parseInt(e.dragsizeValue);let a=document.createElement("div");a.style.position="absolute",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.width="0.2rem",a.style.height="0.2rem",a.style.setProperty("border-radius","50%","important"),a.style.setProperty("background-color","white"),a.id="mytexttospeechdivinner",speechCircle.appendChild(a)}speechCircle.id="mytexttospeechdiv",(!inIframe()||inIframe()&&document.body&&document.body.children.length>1)&&document.body.appendChild(speechCircle),getBookmarkFromStorage(window.location.href),dragElement(speechCircle),checkIfOn()}currentVoice=e.voiceIndex,voiceName=e.voiceName,speechRate=e.voiceSeed/100,t=e.replaceStr,n=e.spacetoplay,l=e.autoplay,NotOnboundary=e.divhilight,yellowHighlightOnly=e.yhighlightonly,(null==replaceLen||replaceLen!=t)&&(replaceDictionary={"[̀-ͯ]":"","[“”]":'"'},eraseDictionary={},autoPlayList={},domain="All",attributeName=null,attributeValue=null,removeNickNames=null,listOfVoices="united states|new zealand|canda|united kingdom|australia|south africa",listOfLocales="english",EngVoicesArr=[],outputOriginalText=!1,outputWhatIsBeingRead=!1,defaultKey=!0,processLines(t.split(/\r?\n/)),urlDataArray=[],processLines(n.split(/\r?\n/),0),urlDataArray.length>0&&addToAutoPlay(urlDataArray[0].website,urlDataArray[0].nt),null==replaceLen&&(urlDataArray=[],processLines(l.split(/\r?\n/),1),urlDataArray.length>0&&autoClickToStart(urlDataArray[0].website,urlDataArray[0].nt,urlDataArray[0].text)),replaceDictionary["\\s{2,}"]=" ",(lastReplaceDictionaryStr!=objToString(replaceDictionary)||lastEraseDictionary!=objToString(eraseDictionary))&&(alldescendants=[],_ultra_Xstr="",x=null,!canceled&&0!=_ultra_index&&docsFirstChild&&playAfterOptionsUpdate())),lastReplaceDictionaryStr=objToString(replaceDictionary),lastEraseDictionary=objToString(eraseDictionary),replaceLen=t,e.spacebarValue?document.addEventListener("keydown",logKey):document.removeEventListener("keydown",logKey),spacebarValue=e.spacebarValue}function objToString(e){if(e instanceof Object==!1)return e;let t="";for(let[n,l]of Object.entries(e))t+=`${n} ${objToString(l)}`;return t}function isBlacklisted(e){null==_currentURL&&(_currentURL=window.location.href);for(var t=0;t<e.length;t++)if(e[t].trim().length>4){let n=RegExp(regexEscape(e[t]));if(_currentURL.match(n))return!0}return!1}function addEventsToCostomElement(e,t){let n=RegExp(e);if(_currentURL.match(n)){var l=document.querySelectorAll(t);for(let a=0;l&&a<l.length;a++)el=l[a],console.log(el),el.addEventListener("click",clickHandler),el.addEventListener("dblclick",clickHandler),el.addEventListener("keydown",logKey)}}function checkDomain(e,t){let n=_currentURL;if(t){let l=e.split("#domain:");2==l.length&&(domain=l[1].trim())}if(domain.match(/All/i)&&"all"==domain.trim().toLowerCase())return getDomainVariables(e),!1;let a=RegExp(domain);return!n.match(a,"i")||(getDomainVariables(e),!1)}function getDomainVariables(e){!(0>e.indexOf("#"))&&(2==(options=e.toLowerCase().split("#attributename:")).length&&(attributeName=options[1].trim()),2==(options=e.toLowerCase().split("#attributevalue:")).length&&(attributeValue=options[1].trim()),2==(options=e.toLowerCase().split("#removenicknames:")).length&&(removeNickNames="yes"==options[1].trim().toLowerCase()),2==(options=e.split("#voice:")).length&&(currentVoice=selectVoice(voiceName=regexEscape(options[1].trim()),0),voiceName=regexEscape(voices[currentVoice].name)),2==(options=e.toLowerCase().split("#dynamiccontent:")).length&&(constantlyChangingContent="yes"==options[1].trim().toLowerCase()),2==(options=e.toLowerCase().split("#listofvoices:")).length&&(listOfVoices=regexEscape(options[1].trim()).replace(/, ?/g,"|")),2==(options=e.toLowerCase().split("#listoflocales:")).length&&(listOfLocales=regexEscape(options[1].trim()).replace(/, ?/g,"|")),2==(options=e.toLowerCase().split("#outputoriginaltext:")).length&&(outputOriginalText="yes"==options[1].trim().toLowerCase()),2==(options=e.toLowerCase().split("#outputwhatisbeingread:")).length&&(outputWhatIsBeingRead="yes"==options[1].trim().toLowerCase()),2==(options=e.toLowerCase().split("#lastparagraphshortcutkey:")).length&&(lastParagraphShortcut=options[1].trim()),2==(options=e.toLowerCase().split("#nextparagraphshortcutkey:")).length&&(nextParagraphShortcut=options[1].trim()),2==(options=e.toLowerCase().split("#playpauseshortcutkey:")).length&&(playPauseShortcutKey=options[1].trim(),defaultKey=!1),2==(options=e.toLowerCase().split("#deepscan:")).length&&(allowSVG="yes"==options[1].trim().toLowerCase()),2==(options=e.toLowerCase().split("#readariahidden:")).length&&(readAriaHidden="yes"==options[1].trim().toLowerCase()))}function processLines(e,t=-1){for(var n=0;n<e.length;n++){var l=e[n].split("=>");if(!(t<0&&checkDomain(e[n],1==l.length))&&l&&l[0]&&l.length>1){if(l.length>2||t>=0){if(l[0].match(/erase/i))addToEraseDictionary(l[1],l[2]);else if(0==t)bestMatch(l[0],l[1]);else if(1==t)bestMatch(l[0],l[1],l[2]);else{let a=l[1],r=l[2],o="ig";l.length>3&&l[3]?.trim().length>0&&(o=l[3]),replaceDictionary[a]={value:fx(r),params:o}}}else{let s=regexEscape(l[0]),u=l[1];replaceDictionary[s]=fx(u)}}}}function AddSpaceAlternativeDict(e,t){readMultipleNodes&&e.match(/ /g)&&(replaceDictionary[e=e.replace(/ /g,spaceAlternative)]=fx(t))}function playAfterOptionsUpdate(){let e=richCaretIndex-(whereDidweResume=lastParagraphcharIndex);pause(),removeMultipleNodeHilights(),lastParagraphs?.length>0&&(_curentTarget=lastParagraphs[lastParagraphs.length-1],console.log(void 0),updateIndexes(10,!0),richCaretIndex=e,404==readText()&&(richCaretIndex=0,readText()))}function addToEraseDictionary(e,t){eraseDictionary[e]=t}function addToAutoPlay(e,t){autoPlayList[e]=t}function bestMatch(e,t,n=""){let l=window.location.href,a=RegExp(e);!inIframe()&&l.match(a)&&(urlDataArray.length>0&&l.match(a)[0].length>urlDataArray[0].urlLength&&(urlDataArray=[]),urlDataArray.push({urlLength:l.match(a)[0].length,website:e,nt:t,text:n}))}function autoClickToStart(e,t,n){let l=window.location.href,a=RegExp(e);!inIframe()&&l.match(a)&&!1==oncePerPage&&!1==pressedOnBookmarkOrPlay&&(oncePerPage=!0,nextTrigger=t,nextTriggerText=n,setTimeout(function(){oncePerPage&&!inIframe()&&!trimmer(bookmarkString).length>0&&!0==canceled&&autoPlayThisSite(!1)&&(autoReadContainer=autoPlayThisSite(),pressedOnBookmarkOrPlay=!1,clearSelection(),spaceBarWasPressed())},3e3))}function animateCountdown(e){speechCircle&&speechCircle.style&&(speechCircle.style.transition="all "+e+"s ease-in-out",speechCircle.style.backgroundColor="#2196F3")}function eraseWords(e){for(let[t,n]of Object.entries(eraseDictionary))e=erase(t,n,e);return e}const filler=(e,t=" ")=>Array(e).fill(t).join("");function erase(e,t,n){try{var l;t=t.replace(/[^gmisuyd]/gi,""),0==t.length&&(t="ig");let a=RegExp(e,t),r=!0;for(0>t.indexOf("g")&&(r=!1);null!==(l=a.exec(n));){l.index===a.lastIndex&&r&&a.lastIndex++;var o=l.index,s=o+l[0].length,u=n.substring(0,o);let d=n.substring(o,s),c=RegExp(/[^\n]/,"gi"),g=d.replace(c," ");var $=n.substring(s);if(n=u+g+$,0===a.lastIndex)break}}catch(f){console.log(f)}return n}function fx(e){return e}function checkIfOn(){chrome.storage.local.get({onOff:"on"},function(e){"off"===e.onOff&&!0==canceled&&speechCircle&&hideElement(speechCircle)})}function justLoaded(){chrome.storage.local.get({onOff:"off"},function(e){"off"===e.onOff&&!0==canceled?extentionIsOn=!1:(extentionIsOn=!0,loadDelayedPresets())})}justLoaded();var wasDragged=!1;function updateDragged(e){wasDragged=e}function dragElement(e){var t,n,l,a,r=0,o=0,s=0,u=0,d=[],c=function e(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}(),g=!1;function $(t){if(g=!0,e.style.transition=null,c){t.preventDefault();var n=t.touches[0];s=n.pageX,u=n.pageY,l=n.pageX,a=n.pageY,document.ontouchend=p,document.ontouchmove=f}else(t=t||window.event).preventDefault(),s=t.clientX,u=t.clientY,l=t.clientX,a=t.clientY,document.onmouseup=p,document.onmousemove=f}function f(l){if(c){var a=l.touches[0];try{l.preventDefault()}catch(d){}r=s-a.pageX,o=u-a.pageY,s=a.pageX,u=a.pageY}else(l=l||window.event).preventDefault(),r=s-l.clientX,o=u-l.clientY,s=l.clientX,u=l.clientY;e.style.left&&e.style.top&&(t=parseInt(e.style.left)-3,n=parseInt(e.style.top)),e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-r+"px"}function p(){var r;if(c?(document.ontouchend=null,document.ontouchmove=null):(document.onmouseup=null,document.onmousemove=null),e.style.bottom=circlebottom,e.style.right=circleright,e.style.left=circleleft,e.style.top=circletop,(void 0==t||void 0==n)&&(t=s,n=u),("10px"==circletop||null==x)&&!1==hasSelection()&&!1==m(l,s,a,u)&&!0==canceled&&(0==trimmer(bookmarkString).length||!0==pressedOnBookmarkOrPlay)&&(oncePerPage=!1,C(null,"100px"),r=setInterval(function(){C(null,"10px"),clearInterval(r)},2e3)),hasSelection()&&!1==m(l,s,a,u)||!1==canceled&&!1==m(l,s,a,u))t=s,n=u,_(!0);else if(t&&n&&g){g=!1,d=[];var o=document.elementFromPoint(t+dragsizeValue/2,n+dragsizeValue/2);if(o&&d.push(o),(o=document.elementsFromPoint(t+dragsizeValue/2,n+dragsizeValue/2))&&o.length>1&&d.push(document.elementsFromPoint(t+dragsizeValue/2,n+dragsizeValue/2)[1]),!1==m(l,s,a,u)){if(_ultrafast&&!1==pressedOnBookmarkOrPlay&&trimmer(bookmarkString).length>0){autoPlayThisSite(!1)&&(autoReadContainer=autoPlayThisSite()),pressedOnBookmarkOrPlay=!0,(d=[]).push("bookmark"),_(!1);return}_(!0);return}px=t+dragsizeValue/2,py=n+dragsizeValue/2,d&&d.length>0&&_()}}function m(e,t,n,l){return e&&t&&n&&l&&10>Math.abs(e-t)&&10>Math.abs(n-l)?(updateDragged(!1),!1):(updateDragged(!0),!0)}function _(e=!1){!1==canceled?e?togglePlayButton():sendClick(null,d):chrome.storage.local.get({onOff:"off",isPlaying:"off"},function(t){"off"!==t.onOff&&"off"==t.isPlaying&&(e?hasSelection()?sendClick(null,window.getSelection().anchorNode.parentNode):(null==x&&sendMessageToBackground("play-selection"),togglePlayButton()):sendClick(null,d))})}function C(e,t){speechCircle&&speechCircle.style&&(speechCircle.style.transition="all .5s ease-in-out",speechCircle.style.left=e,speechCircle.style.right=t)}c?e.ontouchstart=$:e.onmousedown=$}